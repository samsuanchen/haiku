<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Forth Haiku Editor</title>
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<link rel="stylesheet" type="text/css" href="./Forth Haiku/Forth Haiku Editor_files/forthsalon.css">
<meta name="viewport" content="width=600">
<meta name="viewport" content="initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head><body onload="init()" bgcolor="#888"><div class="section">
<div>
<div width="256" height="256" name="haiku" onclick="onClick()" onmousemove="onMouseMove()" class="crosshair">
<canvas width="256" height="256" id="cv"></canvas>
<textarea style="width: 256; height:256" onkeyup="onKeyUp()" id="src_code" rows="30"></textarea>
<a name="animated" style="display: none;">a</a>
</div>
</div>
<div id="mous"> 000, 000 clicked 000, 000</div>
<span id="tag_area">style:short | chars:93 | words:28 | lines:4,8,6,10</span>
<script type="text/javascript" src="./Forth Haiku/Forth Haiku Editor_files/haiku.js"></script>
<script type="text/javascript">
var x,y,click={x:0,y:0};
var e=0.005;
function d4(n){
  if(n>e){
    var v=n.toString().substr(0,4);
    return ' '+v+"00".substr(0,4-v.toString().length);
  }
  return " 0.00"
}
function showMouse(x,y){
  mous.innerHTML=d4(x)+','+d4(y)+' click at '+d4(click.x)+','+d4(click.y);
}
function onMouseMove(){
  x=(event.pageX-cv.offsetLeft)/256+e;
  y=(256-(event.pageY-cv.offsetTop-256))/256+e;
  if(x>=0 && x<=1 && y>=0 && y<=1){
  	showMouse(x,y);
//	update_tags();
  }
}
function onClick(){
  if(x>=0 && x<=1 && y>=0 && y<=1){
	click={x:x,y:y};
	update_tags();
  }
}
function init() {
  var src=localStorage.getItem('myHaikuSrc');
  if(src)src_code.value=src;
  var c=localStorage.getItem('myClick');
  if(c)click=JSON.parse(c);
  showMouse(x,y);
  animate_haikus(function() {});
}
function onKeyUp(){
  update_tags();
}
function update_tags() {
  var s=src_code.value;
  if(s!==localStorage.getItem('myHaikuSrc'))
    localStorage.setItem('myHaikuSrc',s);
  var c=JSON.stringify(click);
  if(c!==localStorage.getItem('myClick'))
    localStorage.setItem('myClick',c);
//var changed=src.trimRight();		// 
//if(src===changed)changed+=' ';	// make sure source is changed
//src_code.value=changed;			// for recompiling
  var m=s.match(/^[^\n]+( ?\n)/), r=m[1], n=r.length, t=n==1?' \n':'\n';
  console.log(n,t.length);
  src_code.value=s.replace(r,t)
  tag_area.innerHTML = code_tags(s).join(' | ');
}
</script></div></body></html>